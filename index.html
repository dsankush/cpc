<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Coromandel CPC ‚Äî Campaign Dashboard</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    :root{
      --bg:#0f0f23;
      --panel:#1a1a2e;
      --card:#16213e;
      --card-hover:#1f2d47;
      --muted:#94a3b8;
      --text:#f1f5f9;
      --acc1:#ff6b9d;
      --acc2:#ffa500;
      --acc3:#00d4ff;
      --acc4:#c060ff;
      --acc5:#39ff14;
      --ring:#2d3748;
      --border:#4a5568;
      --shadow:rgba(0,0,0,.4);
      --shadow-lg:rgba(0,0,0,.6);
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;overflow-x:hidden}
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
      background-attachment:fixed;color:var(--text)}
    .app{display:grid;grid-template-rows:auto 1fr auto;min-height:100vh}
    
    /* Header */
    header{position:sticky;top:0;z-index:30;
      backdrop-filter:saturate(180%) blur(20px);
      background:rgba(26,26,46,.98);
      border-bottom:3px solid transparent;
      border-image:linear-gradient(90deg,var(--acc1),var(--acc3),var(--acc4)) 1;
      box-shadow:0 8px 32px var(--shadow-lg)}
    .bar{display:flex;align-items:center;gap:20px;padding:20px 32px;flex-wrap:wrap}
    .logo{display:flex;align-items:center;gap:16px;
      padding:16px 32px;border-radius:20px;
      background:linear-gradient(135deg,rgba(255,107,157,.15),rgba(0,212,255,.15));
      backdrop-filter:blur(12px);
      border:2px solid rgba(255,107,157,.3);
      box-shadow:0 8px 24px rgba(255,107,157,.25)}
    .dot{width:16px;height:16px;border-radius:50%;
      background:linear-gradient(135deg,var(--acc1),var(--acc3));
      box-shadow:0 0 24px var(--acc1);
      animation:pulse 2s ease-in-out infinite}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.2);opacity:.6}}
    .title{font-size:22px;font-weight:800;letter-spacing:1px;
      background:linear-gradient(90deg,var(--acc1),var(--acc3));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      background-clip:text}
    .header-actions{margin-left:auto;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;
      padding:12px 20px;border-radius:12px;border:2px solid var(--acc3);
      background:linear-gradient(135deg,var(--acc3),#0099cc);
      color:var(--bg);font-weight:700;cursor:pointer;font-size:14px;
      transition:all .3s ease;white-space:nowrap;
      box-shadow:0 4px 16px rgba(0,212,255,.4);text-transform:uppercase;letter-spacing:.5px}
    .btn:hover{transform:translateY(-3px) scale(1.05);box-shadow:0 8px 32px rgba(0,212,255,.6)}
    .btn-logout{background:linear-gradient(135deg,var(--acc1),#cc0055);
      border-color:var(--acc1);box-shadow:0 4px 16px rgba(255,107,157,.4);color:white}
    .btn-logout:hover{box-shadow:0 8px 32px rgba(255,107,157,.6)}

    /* Layout */
    .main{display:flex;flex-direction:column;gap:28px;padding:32px;max-width:100%;margin:0}
    .panel{background:var(--panel);
      border:2px solid transparent;
      border-image:linear-gradient(135deg,var(--acc1),var(--acc3)) 1;
      border-radius:20px;padding:24px;
      box-shadow:0 8px 24px var(--shadow);transition:all .3s ease;position:relative;overflow:hidden}
    .panel::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;
      background:linear-gradient(90deg,var(--acc1),var(--acc3),var(--acc4));opacity:.8}
    .panel:hover{transform:translateY(-4px);box-shadow:0 12px 40px var(--shadow-lg)}

    /* Filters */
    .filters-horizontal{background:var(--panel);
      border:2px solid rgba(255,107,157,.3);border-radius:20px;
      padding:28px;box-shadow:0 8px 24px var(--shadow);
      display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:20px;align-items:end;
      position:relative;overflow:hidden}
    .filters-horizontal::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;
      background:linear-gradient(90deg,var(--acc1),var(--acc3),var(--acc4));opacity:1}
    .filters-horizontal .group{display:flex;flex-direction:column;gap:8px}
    .filters-horizontal label{font-size:11px;color:var(--acc3);font-weight:700;
      text-transform:uppercase;letter-spacing:1px}
    .filters-horizontal select,.filters-horizontal input{width:100%;padding:12px 14px;
      border-radius:12px;border:2px solid var(--ring);
      background:var(--bg);color:var(--text);outline:none;font-size:13px;
      transition:all .2s ease;font-weight:500}
    .filters-horizontal select:hover,.filters-horizontal input:hover{
      border-color:var(--acc3);box-shadow:0 0 16px rgba(0,212,255,.3)}
    .filters-horizontal select:focus,.filters-horizontal input:focus{
      border-color:var(--acc3);box-shadow:0 0 0 4px rgba(0,212,255,.2)}
    .filters-horizontal .btn{padding:12px 24px;font-size:13px}

    /* Content Grid */
    .content{display:grid;grid-template-columns:repeat(12,1fr);gap:28px}
    .card{background:var(--card);
      border:2px solid rgba(255,107,157,.2);border-radius:20px;
      padding:28px;min-height:180px;display:flex;flex-direction:column;
      box-shadow:0 8px 24px var(--shadow);transition:all .3s ease;position:relative;overflow:hidden}
    .card::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;
      background:linear-gradient(90deg,var(--acc1),var(--acc3),var(--acc4));opacity:0;transition:opacity .3s}
    .card:hover{border-color:var(--acc3);transform:translateY(-6px);
      box-shadow:0 16px 48px var(--shadow-lg)}
    .card:hover::before{opacity:1}
    .card h3{margin:0 0 16px;font-size:13px;color:var(--acc3);font-weight:800;
      text-transform:uppercase;letter-spacing:1.5px}
    
    /* KPI Cards */
    .kpi-hero{display:grid;grid-template-columns:220px 1fr;gap:40px;align-items:center}
    .kpi-main-circle{width:220px;height:220px;border-radius:50%;
      display:flex;flex-direction:column;align-items:center;justify-content:center;
      background:linear-gradient(135deg,rgba(255,107,157,.2),rgba(0,212,255,.2));
      border:4px solid var(--acc1);box-shadow:0 12px 40px rgba(255,107,157,.4);
      position:relative}
    .kpi-main-circle::after{content:'';position:absolute;inset:-12px;border-radius:50%;
      background:linear-gradient(135deg,var(--acc1),var(--acc3));opacity:.2;z-index:-1;
      animation:pulse 3s ease-in-out infinite}
    .kpi-main-label{font-size:13px;color:var(--acc3);font-weight:800;
      text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
    .kpi-main-value{font-size:64px;font-weight:900;line-height:1;
      background:linear-gradient(135deg,var(--acc1),var(--acc3));
      -webkit-background-clip:text;-webkit-text-fill-color:transparent;
      background-clip:text}
    .kpi-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:20px}
    .kpi-item{background:linear-gradient(135deg,rgba(255,107,157,.1),rgba(0,212,255,.1));
      border:2px solid rgba(255,107,157,.3);border-radius:20px;padding:24px;
      text-align:center;transition:all .3s ease;position:relative;overflow:hidden}
    .kpi-item::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;
      background:linear-gradient(90deg,var(--acc1),var(--acc3));opacity:0;transition:opacity .3s}
    .kpi-item:hover{transform:translateY(-6px) scale(1.03);
      box-shadow:0 12px 32px rgba(255,107,157,.4)}
    .kpi-item:hover::before{opacity:1}
    .kpi-label{font-size:11px;color:var(--muted);text-transform:uppercase;
      letter-spacing:1px;font-weight:700;margin-bottom:12px}
    .kpi-value{font-size:40px;font-weight:900;margin-bottom:8px}
    .kpi-item:nth-child(1){border-color:rgba(57,255,20,.4)}
    .kpi-item:nth-child(1)::before{background:var(--acc5)}
    .kpi-item:nth-child(1) .kpi-value{color:var(--acc5)}
    .kpi-item:nth-child(2){border-color:rgba(255,165,0,.4)}
    .kpi-item:nth-child(2)::before{background:var(--acc2)}
    .kpi-item:nth-child(2) .kpi-value{color:var(--acc2)}
    .kpi-item:nth-child(3){border-color:rgba(192,96,255,.4)}
    .kpi-item:nth-child(3)::before{background:var(--acc4)}
    .kpi-item:nth-child(3) .kpi-value{color:var(--acc4)}
    .kpi-item:nth-child(4){border-color:rgba(0,212,255,.4)}
    .kpi-item:nth-child(4)::before{background:var(--acc3)}
    .kpi-item:nth-child(4) .kpi-value{color:var(--acc3)}
    .kpi-item:nth-child(5){border-color:rgba(255,107,157,.4)}
    .kpi-item:nth-child(5)::before{background:var(--acc1)}
    .kpi-item:nth-child(5) .kpi-value{color:var(--acc1)}
    .kpi-percent{font-size:13px;color:var(--muted);font-weight:600}

    /* Date Range Picker */
    .daterange-container{position:relative}
    .daterange-display{padding:12px 14px;border-radius:12px;border:2px solid var(--ring);
      background:var(--bg);color:var(--text);cursor:pointer;font-size:13px;font-weight:500;
      transition:all .2s ease;display:flex;align-items:center;gap:8px}
    .daterange-display:hover{border-color:var(--acc3);box-shadow:0 0 16px rgba(0,212,255,.3)}
    .daterange-picker{position:absolute;top:100%;left:0;margin-top:8px;
      background:var(--panel);border:2px solid var(--acc3);border-radius:16px;
      padding:20px;box-shadow:0 12px 40px var(--shadow-lg);z-index:100;display:none;min-width:300px}
    .daterange-picker.active{display:block}
    .daterange-row{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}
    .daterange-row:last-child{margin-bottom:0}
    .daterange-row label{font-size:11px;color:var(--acc3);font-weight:700;
      text-transform:uppercase;letter-spacing:1px}
    .daterange-row input{padding:10px;border-radius:10px;border:2px solid var(--ring);
      background:var(--bg);color:var(--text);font-size:13px}
    .daterange-actions{display:flex;gap:10px;margin-top:16px}
    .daterange-actions button{flex:1;padding:10px;border-radius:10px;border:2px solid var(--acc3);
      background:var(--acc3);color:var(--bg);font-weight:700;cursor:pointer;font-size:12px;
      transition:all .2s ease}
    .daterange-actions button:hover{transform:scale(1.05)}
    .daterange-actions button.clear{background:transparent;color:var(--acc1);border-color:var(--acc1)}

    /* India Map */
    #indiaMapContainer{width:100%;height:700px;position:relative;
      border-radius:20px;overflow:hidden;border:2px solid rgba(0,212,255,.3)}
    #indiaMap{width:100%;height:100%;z-index:1}
    .leaflet-container{background:linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);font-family:Inter,sans-serif}
    .leaflet-popup-content-wrapper{background:var(--panel);border-radius:20px;
      box-shadow:0 16px 48px rgba(0,0,0,.8);border:3px solid var(--acc3)}
    .leaflet-popup-content{margin:24px;font-size:13px;color:var(--text)}
    .leaflet-popup-tip{background:var(--panel);border:3px solid var(--acc3)}
    .map-popup-state{font-size:20px;font-weight:900;color:var(--acc1);margin-bottom:16px;
      padding-bottom:12px;border-bottom:3px solid var(--ring)}
    .map-popup-row{display:flex;justify-content:space-between;align-items:center;margin:12px 0;padding:10px 0}
    .map-popup-label{font-size:11px;color:var(--muted);text-transform:uppercase;
      letter-spacing:.5px;font-weight:700}
    .map-popup-value{font-size:22px;font-weight:900;color:var(--text)}
    .map-popup-success{color:var(--acc5)!important}
    .map-popup-pending{color:var(--acc4)!important}
    .map-popup-rejected{color:var(--acc2)!important}
    .state-marker-pin{position:relative;width:60px;height:60px;display:flex;align-items:center;justify-content:center}
    .state-marker-inner{position:relative;z-index:2;background:var(--panel);border-radius:14px;
      padding:10px 14px;box-shadow:0 8px 32px rgba(0,0,0,.6);border:3px solid;
      font-weight:900;font-size:14px;text-align:center;min-width:90px;
      transition:all .3s ease;cursor:pointer}
    .state-marker-inner:hover{transform:translateY(-6px) scale(1.1);box-shadow:0 16px 48px rgba(0,0,0,.8)}
    .state-marker-name{font-size:10px;color:var(--muted);text-transform:uppercase;
      letter-spacing:.5px;margin-bottom:6px;font-weight:700}
    .state-marker-count{font-size:20px;font-weight:900;display:flex;align-items:center;justify-content:center;gap:4px}
    .marker-ripple{position:absolute;width:100%;height:100%;border-radius:50%;
      background:radial-gradient(circle, rgba(0,212,255,.4) 0%, rgba(0,212,255,0) 70%);
      animation:ripple 2s ease-in-out infinite;z-index:1}
    @keyframes ripple{0%{transform:scale(.8);opacity:.8}50%{transform:scale(1.3);opacity:.3}100%{transform:scale(.8);opacity:.8}}
    .state-marker-level-1{border-color:var(--acc5)}
    .state-marker-level-1 .state-marker-count{color:var(--acc5)}
    .state-marker-level-2{border-color:#22c55e}
    .state-marker-level-2 .state-marker-count{color:#22c55e}
    .state-marker-level-3{border-color:#84cc16}
    .state-marker-level-3 .state-marker-count{color:#84cc16}
    .state-marker-level-4{border-color:var(--acc2)}
    .state-marker-level-4 .state-marker-count{color:var(--acc2)}
    .state-marker-level-5{border-color:var(--acc1)}
    .state-marker-level-5 .state-marker-count{color:var(--acc1)}
    .legend{position:absolute;bottom:24px;right:24px;background:rgba(26,26,46,.98);
      padding:24px;border-radius:20px;box-shadow:0 12px 40px var(--shadow-lg);
      border:3px solid var(--acc3);z-index:1000;backdrop-filter:blur(12px)}
    .legend-title{font-size:14px;font-weight:900;color:var(--acc3);margin-bottom:16px;
      text-transform:uppercase;letter-spacing:1.5px}
    .legend-item{display:flex;align-items:center;gap:12px;margin:10px 0;font-size:13px;font-weight:700;color:var(--text)}
    .legend-color{width:32px;height:24px;border-radius:8px;border:2px solid;box-shadow:0 4px 12px rgba(0,0,0,.4)}

    .footer{padding:20px 32px;color:var(--muted);
      border-top:3px solid transparent;
      border-image:linear-gradient(90deg,var(--acc1),var(--acc3),var(--acc4)) 1;
      text-align:center;font-size:14px;background:var(--panel);font-weight:600;letter-spacing:.5px}

    /* Login */
    .overlay{position:fixed;inset:0;
      background:linear-gradient(135deg, rgba(15,15,35,.97) 0%, rgba(26,26,46,.97) 50%, rgba(22,33,62,.97) 100%);
      display:grid;place-items:center;z-index:100;backdrop-filter:blur(12px)}
    .login{width:min(92vw,440px);background:var(--panel);
      border:3px solid var(--acc1);border-radius:24px;padding:40px;
      box-shadow:0 24px 80px rgba(0,0,0,.8);
      animation:slideIn .5s ease;position:relative;overflow:hidden}
    .login::before{content:'';position:absolute;top:0;left:0;right:0;height:4px;
      background:linear-gradient(90deg,var(--acc1),var(--acc3),var(--acc4))}
    @keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}
    .login h2{margin:0 0 12px;font-size:28px;color:var(--text);font-weight:900}
    .login p{margin:0 0 28px;color:var(--muted);font-size:15px;font-weight:500}
    .field{display:flex;flex-direction:column;gap:10px;margin:20px 0}
    .field label{font-size:12px;color:var(--acc3);font-weight:700;text-transform:uppercase;letter-spacing:1px}
    .field input{padding:16px;border-radius:14px;border:2px solid var(--ring);
      background:var(--bg);color:var(--text);font-size:15px;font-weight:500}
    .field input:focus{outline:none;border-color:var(--acc3);box-shadow:0 0 0 4px rgba(0,212,255,.2)}
    .err{color:var(--acc1);font-size:14px;min-height:20px;margin-top:12px;font-weight:600}

    @media (max-width: 1100px){
      .kpi-hero{grid-template-columns:1fr}
      .kpi-main-circle{margin:0 auto}
      .kpi-grid{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
      .filters-horizontal{grid-template-columns:repeat(auto-fit,minmax(140px,1fr))}
      #indiaMapContainer{height:500px}
    }
    @media (max-width: 640px){
      .bar{padding:16px 20px}
      .main{padding:20px;gap:20px}
      .kpi-grid{grid-template-columns:1fr}
      .header-actions{width:100%;justify-content:flex-start}
      #indiaMapContainer{height:400px}
      .filters-horizontal{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
<div class="app">
  <header>
    <div class="bar">
      <div class="logo">
        <span class="dot"></span>
        <h1 class="title">Coromandel CPC Campaign Dashboard</h1>
      </div>
      <div class="header-actions">
        <button class="btn" id="downloadBtn">üì• Download</button>
        <button class="btn btn-logout" id="logoutBtn">üö™ Logout</button>
      </div>
    </div>
  </header>

  <main class="main">
    <!-- Horizontal Filters -->
    <div class="filters-horizontal">
      <div class="group">
        <label for="dateRange">üìÖ Date Range</label>
        <div class="daterange-container">
          <div class="daterange-display" id="dateRangeDisplay">Select dates...</div>
          <div class="daterange-picker" id="dateRangePicker">
            <div class="daterange-row">
              <label>From Date</label>
              <input id="dateFrom" type="date" />
            </div>
            <div class="daterange-row">
              <label>To Date</label>
              <input id="dateTo" type="date" />
            </div>
            <div class="daterange-actions">
              <button class="apply" id="applyDateRange">Apply</button>
              <button class="clear" id="clearDateRange">Clear</button>
            </div>
          </div>
        </div>
      </div>
      <div class="group">
        <label for="state">üåç State</label>
        <select id="state"></select>
      </div>
      <div class="group">
        <label for="district">üìç District</label>
        <select id="district"></select>
      </div>
      <div class="group">
        <label for="retailer">üè™ Retailer</label>
        <select id="retailer"></select>
      </div>
      <div class="group">
        <label for="product">üì¶ Product</label>
        <select id="product"></select>
      </div>
      <div class="group">
        <label for="quantity">‚öñÔ∏è Quantity</label>
        <select id="quantity"></select>
      </div>
      <div class="group">
        <label for="status">‚úÖ Status</label>
        <select id="status"></select>
      </div>
      <div class="group" style="display:flex;align-items:flex-end">
        <button class="btn" id="resetBtn" style="width:100%;background:linear-gradient(135deg,var(--acc1),#cc0055);border-color:var(--acc1)">üîÑ Reset</button>
      </div>
    </div>

    <section class="content">
      <!-- Total Scans with Hero Design -->
      <div class="card" style="grid-column: span 12">
        <h3>üéØ Campaign Performance Overview</h3>
        <div class="kpi-hero">
          <div class="kpi-main-circle">
            <div class="kpi-main-label">Total Scans</div>
            <div class="kpi-main-value" id="kpiTotalBig">0</div>
          </div>
          <div class="kpi-grid">
            <div class="kpi-item">
              <div class="kpi-label">‚úÖ Approved</div>
              <div class="kpi-value" id="kpiYes">0</div>
              <div class="kpi-percent" id="kpiYesPct">0%</div>
            </div>
            <div class="kpi-item">
              <div class="kpi-label">‚ùå Rejected</div>
              <div class="kpi-value" id="kpiNo">0</div>
              <div class="kpi-percent" id="kpiNoPct">0%</div>
            </div>
            <div class="kpi-item">
              <div class="kpi-label">‚è≥ Pending</div>
              <div class="kpi-value" id="kpiPending">0</div>
              <div class="kpi-percent" id="kpiPendingPct">0%</div>
            </div>
            <div class="kpi-item">
              <div class="kpi-label">üë®‚Äçüåæ Farmers</div>
              <div class="kpi-value" id="kpiTotalFarmers">0</div>
              <div class="kpi-percent" id="kpiUniqueFarmers">Unique: 0</div>
            </div>
            <div class="kpi-item">
              <div class="kpi-label">üè™ Retailers</div>
              <div class="kpi-value" id="kpiActiveRetailers">0</div>
              <div class="kpi-percent">of 1,256 total</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Status Chart -->
      <div class="card" style="grid-column: span 4">
        <h3>üìä Order Approval Status</h3>
        <canvas id="statusChart" height="280"></canvas>
      </div>

      <!-- Trend Chart -->
      <div class="card" style="grid-column: span 8">
        <h3>üìà Time Trend (Scans per Day)</h3>
        <canvas id="trendChart" height="280"></canvas>
      </div>

      <!-- Top States Table -->
      <div class="card" style="grid-column: span 6">
        <h3>üèÜ States by Scans</h3>
        <div id="statesTable" style="overflow-y:auto;max-height:380px;margin-top:12px"></div>
      </div>

      <!-- Retailer Performance -->
      <div class="card" style="grid-column: span 6">
        <h3>üè™ Retailer Performance</h3>
        <canvas id="retailerChart" height="240"></canvas>
      </div>

      <!-- District Scans -->
      <div class="card" style="grid-column: span 6">
